# Lark Message Hub v0.2.0 - è¦ä»¶å®šç¾©æ›¸

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æœ€çµ‚æ›´æ–°æ—¥**: 2025-12-05
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ‰¿èªæ¸ˆã¿ãƒ»å®Ÿè£…å®Œäº†

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå
**Lark Message Hub** - çµ±åˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### 1.2 ãƒ“ã‚¸ãƒ§ãƒ³
è¤‡æ•°ãƒãƒ£ãƒãƒ«ã‹ã‚‰ã®é¡§å®¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ Lark ã«é›†ç´„ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã§åŠ¹ç‡çš„ãªé¡§å®¢å¯¾å¿œã‚’å®Ÿç¾ã™ã‚‹ã€‚

### 1.3 ç›®çš„
- é¡§å®¢å¯¾å¿œã®ä¸€å…ƒåŒ–ã«ã‚ˆã‚‹å¿œç­”æ™‚é–“çŸ­ç¸®
- ãƒãƒ¼ãƒ é–“ã®æƒ…å ±å…±æœ‰ä¿ƒé€²
- å¯¾å¿œæ¼ã‚Œã®é˜²æ­¢
- é¡§å®¢æº€è¶³åº¦ã®å‘ä¸Š

### 1.4 ã‚¹ã‚³ãƒ¼ãƒ—

| é …ç›® | å†…å®¹ |
|------|------|
| å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã€å–¶æ¥­ãƒãƒ¼ãƒ  |
| å¯¾è±¡ãƒãƒ£ãƒãƒ« | LINE, SMS, WhatsApp, Email, Webchat, Facebook Messenger, Instagram DM, LinkedIn Messaging |
| çµ±åˆå…ˆ | Lark (Feishu) |
| ã‚¤ãƒ³ãƒ•ãƒ© | AWS Serverless |

---

## 2. æ©Ÿèƒ½è¦ä»¶

### 2.1 Inbound ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†

#### 2.1.1 ãƒãƒ£ãƒãƒ«çµ±åˆ

| ãƒãƒ£ãƒãƒ« | å„ªå…ˆåº¦ | API/SDK | å®Ÿè£…çŠ¶æ…‹ |
|----------|--------|---------|----------|
| LINE | P0-Critical | Twilio Conversations | âœ… å®Œäº† |
| SMS | P1-High | Twilio Conversations | âœ… å®Œäº† |
| WhatsApp | P1-High | Twilio Conversations | âœ… å®Œäº† |
| Webchat | P0-Critical | Twilio Conversations | âœ… å®Œäº† |
| Email | P1-High | AWS SES + S3 | âœ… å®Œäº† |
| Facebook Messenger | P2-Medium | Meta Graph API | âœ… å®Œäº† |
| Instagram DM | P2-Medium | Meta Graph API | âœ… å®Œäº† |
| LinkedIn Messaging | P3-Low | LinkedIn Marketing API | âœ… å®Œäº† |

#### 2.1.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ­£è¦åŒ–

ã™ã¹ã¦ã®ãƒãƒ£ãƒãƒ«ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›:

```typescript
interface NormalizedMessage {
  channel: ChannelType;
  senderId: string;
  senderName?: string;
  content: string;
  contentType: 'text' | 'image' | 'file' | 'audio' | 'video';
  timestamp: Date;
  metadata: Record<string, any>;
  identifierType: 'phone' | 'email' | 'social_id';
  identifierValue: string;
}
```

#### 2.1.3 é¡§å®¢è­˜åˆ¥

| è­˜åˆ¥å­ã‚¿ã‚¤ãƒ— | å¯¾è±¡ãƒãƒ£ãƒãƒ« |
|--------------|--------------|
| é›»è©±ç•ªå· | LINE, SMS, WhatsApp |
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | Email, Webchat |
| ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ID | Facebook, Instagram, LinkedIn |

### 2.2 Lark é€šçŸ¥æ©Ÿèƒ½

#### 2.2.1 Interactive Card

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æ™‚ã« Lark ã‚°ãƒ«ãƒ¼ãƒ—ã¸é€šçŸ¥ã‚«ãƒ¼ãƒ‰ã‚’é€ä¿¡:

- **é¡§å®¢æƒ…å ±è¡¨ç¤º**: åå‰ã€ãƒãƒ£ãƒãƒ«ã€éå»ã®å¯¾å¿œå±¥æ­´
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹**: ãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³**:
  - è¿”ä¿¡å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ï¼ˆå¯¾å¿œä¸­/å®Œäº†/ä¿ç•™ï¼‰
  - æ‹…å½“è€…ã‚¢ã‚µã‚¤ãƒ³
  - å®šå‹æ–‡é¸æŠ

#### 2.2.2 ã‚¹ãƒ¬ãƒƒãƒ‰ç®¡ç†

- åŒä¸€é¡§å®¢ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã¾ã¨ã‚ã‚‹
- ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `open` | `in_progress` | `resolved` | `closed`
- æ‹…å½“è€…ã‚¢ã‚µã‚¤ãƒ³æ©Ÿèƒ½

### 2.3 Outbound è¿”ä¿¡æ©Ÿèƒ½

#### 2.3.1 è¿”ä¿¡ãƒ•ãƒ­ãƒ¼

1. ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒ Lark ã‚«ãƒ¼ãƒ‰ä¸Šã§è¿”ä¿¡å…¥åŠ›
2. ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ Webhook å—ä¿¡
3. å…ƒãƒãƒ£ãƒãƒ«ç‰¹å®š
4. è©²å½“ API ã§è¿”ä¿¡é€ä¿¡
5. Lark ã‚«ãƒ¼ãƒ‰æ›´æ–°ï¼ˆé€ä¿¡å®Œäº†è¡¨ç¤ºï¼‰

#### 2.3.2 å¯¾å¿œãƒãƒ£ãƒãƒ«åˆ¥è¿”ä¿¡

| ãƒãƒ£ãƒãƒ« | è¿”ä¿¡æ–¹æ³• |
|----------|----------|
| LINE | Twilio Conversations API |
| SMS | Twilio Conversations API |
| WhatsApp | Twilio Conversations API |
| Webchat | Twilio Conversations API |
| Email | AWS SES |
| Facebook | Meta Send API |
| Instagram | Meta Send API |
| LinkedIn | LinkedIn Messaging API |

### 2.4 é¡§å®¢ãƒ»ã‚¹ãƒ¬ãƒƒãƒ‰ç®¡ç†

#### 2.4.1 é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```typescript
interface Customer {
  id: string;
  name?: string;
  identifiers: CustomerIdentifier[];
  channels: ChannelType[];
  tags: string[];
  notes?: string;
  firstContactAt: Date;
  lastContactAt: Date;
  totalThreads: number;
  metadata: Record<string, any>;
}
```

#### 2.4.2 ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```typescript
interface Thread {
  id: string;
  customerId: string;
  channel: ChannelType;
  status: ThreadStatus;
  assigneeId?: string;
  assigneeName?: string;
  larkMessageId?: string;
  larkChatId?: string;
  externalThreadId?: string;
  priority: 'low' | 'medium' | 'high' | 'urgent';
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
  resolvedAt?: Date;
}
```

### 2.5 å®šå‹æ–‡ãƒœã‚¿ãƒ³æ©Ÿèƒ½

- ã‚«ãƒ†ã‚´ãƒªåˆ¥å®šå‹æ–‡ç®¡ç†
- ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯é€ä¿¡
- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç½®æ›ï¼ˆé¡§å®¢åã€æ—¥æ™‚ãªã©ï¼‰

### 2.6 åŸºæœ¬ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

| ãƒ«ãƒ¼ãƒ« | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|------------|
| å–¶æ¥­æ™‚é–“å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | è‡ªå‹•å¿œç­”é€ä¿¡ |
| æœªå¯¾å¿œ30åˆ†çµŒé | ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ |
| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º | æ‹…å½“è€…è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ |
| VIPé¡§å®¢ | å„ªå…ˆåº¦è‡ªå‹•è¨­å®š |

### 2.7 é«˜åº¦ãªé€šçŸ¥ãƒ«ãƒ¼ãƒ«

- ãƒãƒ£ãƒãƒ«åˆ¥é€šçŸ¥å…ˆè¨­å®š
- å„ªå…ˆåº¦åˆ¥ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- SLA ã‚¢ãƒ©ãƒ¼ãƒˆ

### 2.8 AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆçµ±åˆ

- **è¿”ä¿¡ææ¡ˆ**: éå»ã®å¯¾å¿œå±¥æ­´ã‹ã‚‰AIãŒè¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆ
- **æ„Ÿæƒ…åˆ†æ**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆæ¤œå‡º
- **è¦ç´„**: é•·æ–‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‡ªå‹•è¦ç´„
- **ç¿»è¨³**: å¤šè¨€èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‡ªå‹•ç¿»è¨³

### 2.9 åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | èª¬æ˜ |
|------------|------|
| å¿œç­”æ™‚é–“ | åˆå›å¿œç­”ã¾ã§ã®å¹³å‡æ™‚é–“ |
| è§£æ±ºæ™‚é–“ | ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ­ãƒ¼ã‚ºã¾ã§ã®å¹³å‡æ™‚é–“ |
| ãƒãƒ£ãƒãƒ«åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•° | å„ãƒãƒ£ãƒãƒ«ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é‡ |
| æ‹…å½“è€…åˆ¥å¯¾å¿œæ•° | ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼æ¯ã®å¯¾å¿œä»¶æ•° |
| é¡§å®¢æº€è¶³åº¦ | CSAT ã‚¹ã‚³ã‚¢ |

---

## 3. éæ©Ÿèƒ½è¦ä»¶

### 3.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| é …ç›® | è¦ä»¶ |
|------|------|
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | < 3ç§’ |
| Larké€šçŸ¥é…å»¶ | < 5ç§’ |
| åŒæ™‚æ¥ç¶šæ•° | 1,000+ |
| ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ | 100 msg/sec |

### 3.2 å¯ç”¨æ€§

| é …ç›® | è¦ä»¶ |
|------|------|
| ç¨¼åƒç‡ | 99.9% |
| RTO | 1æ™‚é–“ |
| RPO | 5åˆ† |

### 3.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

| é …ç›® | å®Ÿè£… |
|------|------|
| é€šä¿¡æš—å·åŒ– | TLS 1.3 |
| ä¿å­˜ãƒ‡ãƒ¼ã‚¿æš—å·åŒ– | AES-256 (DynamoDB) |
| èªè¨¼ | Webhookç½²åæ¤œè¨¼ (HMAC-SHA256) |
| ç›£æŸ»ãƒ­ã‚° | å…¨æ“ä½œè¨˜éŒ² |
| PIIä¿è­· | æš—å·åŒ– + ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |

### 3.4 ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

- AWS Lambda ã«ã‚ˆã‚‹è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- DynamoDB On-Demand ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£
- API Gateway ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°

### 3.5 ç›£è¦–ãƒ»å¯è¦³æ¸¬æ€§

| ãƒ„ãƒ¼ãƒ« | ç”¨é€” |
|--------|------|
| CloudWatch Logs | ãƒ­ã‚°åé›† |
| CloudWatch Metrics | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦– |
| CloudWatch Alarms | ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ |
| X-Ray | åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° |

---

## 4. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 4.1 æ¦‚è¦å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤–éƒ¨ãƒãƒ£ãƒãƒ«                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚ LINE â”‚ SMS  â”‚WhatsAppâ”‚Emailâ”‚Webchatâ”‚  FB  â”‚ Insta â”‚LinkedInâ”‚
â””â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜
   â”‚      â”‚       â”‚      â”‚      â”‚     â”‚       â”‚      â”‚
   â–¼      â–¼       â–¼      â–¼      â–¼     â–¼       â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Twilio Conversations                          â”‚
â”‚              (LINE, SMS, WhatsApp, Webchat)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway                                   â”‚
â”‚         /webhook/twilio  /webhook/meta  /webhook/email           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Lambda: InboundHandler                           â”‚
â”‚    - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ­£è¦åŒ–                                            â”‚
â”‚    - é¡§å®¢è­˜åˆ¥ãƒ»ä½œæˆ                                              â”‚
â”‚    - ã‚¹ãƒ¬ãƒƒãƒ‰ç®¡ç†                                                â”‚
â”‚    - Larké€šçŸ¥é€ä¿¡                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DynamoDB   â”‚  â”‚  DynamoDB   â”‚  â”‚  DynamoDB   â”‚
â”‚  Customers  â”‚  â”‚   Threads   â”‚  â”‚  Messages   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lark Open Platform                            â”‚
â”‚              - Interactive Cards                                 â”‚
â”‚              - Card Actions Webhook                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Lambda: OutboundHandler                          â”‚
â”‚    - ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†                                        â”‚
â”‚    - è¿”ä¿¡é€ä¿¡                                                    â”‚
â”‚    - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|----------|------|
| Runtime | Node.js 20.x |
| Language | TypeScript 5.x (strict mode) |
| Cloud | AWS (API Gateway, Lambda, DynamoDB, SES, S3) |
| IaC | AWS SAM |
| CI/CD | GitHub Actions |
| External APIs | Lark, Twilio, Meta, LinkedIn, Anthropic |

### 4.3 DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

#### Customers Table

| Attribute | Type | Key |
|-----------|------|-----|
| id | String | PK |
| email | String | GSI |
| phone | String | GSI |
| createdAt | String | - |

#### Threads Table

| Attribute | Type | Key |
|-----------|------|-----|
| id | String | PK |
| customerId | String | GSI |
| status | String | GSI |
| createdAt | String | - |

#### Messages Table

| Attribute | Type | Key |
|-----------|------|-----|
| id | String | PK |
| threadId | String | GSI |
| createdAt | String | SK |

---

## 5. API ä»•æ§˜

### 5.1 Webhook Endpoints

| Endpoint | Method | ç”¨é€” |
|----------|--------|------|
| `/webhook/twilio` | POST | Twilio Conversations Webhook |
| `/webhook/meta` | GET/POST | Meta Webhook (æ¤œè¨¼/ã‚¤ãƒ™ãƒ³ãƒˆ) |
| `/webhook/linkedin` | POST | LinkedIn Webhook |
| `/webhook/email` | POST | Email Webhook (SES) |
| `/webhook/lark` | POST | Lark Card Actions |

### 5.2 Customer API

| Endpoint | Method | ç”¨é€” |
|----------|--------|------|
| `/api/customers` | GET | é¡§å®¢ä¸€è¦§å–å¾— |
| `/api/customers/{id}` | GET | é¡§å®¢è©³ç´°å–å¾— |
| `/api/customers` | POST | é¡§å®¢ä½œæˆ |
| `/api/customers/{id}` | PUT | é¡§å®¢æ›´æ–° |
| `/api/customers/{id}/threads` | GET | é¡§å®¢ã®ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ |

---

## 6. ç’°å¢ƒå¤‰æ•°

```bash
# AWS
AWS_REGION=ap-northeast-1

# Lark
LARK_APP_ID=cli_xxxxx
LARK_APP_SECRET=xxxxx
LARK_VERIFICATION_TOKEN=xxxxx
LARK_DEFAULT_GROUP_ID=oc_xxxxx

# Twilio
TWILIO_ACCOUNT_SID=ACxxxxx
TWILIO_AUTH_TOKEN=xxxxx
TWILIO_CONVERSATIONS_SERVICE_SID=ISxxxxx

# Meta (Facebook/Instagram)
META_APP_SECRET=xxxxx
META_PAGE_ACCESS_TOKEN=xxxxx
META_VERIFY_TOKEN=xxxxx

# LinkedIn
LINKEDIN_ACCESS_TOKEN=xxxxx

# AI
ANTHROPIC_API_KEY=sk-ant-xxxxx

# Logging
LOG_LEVEL=INFO
```

---

## 7. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 7.1 ç’°å¢ƒ

| ç’°å¢ƒ | ç”¨é€” | ãƒ‡ãƒ—ãƒ­ã‚¤ãƒˆãƒªã‚¬ãƒ¼ |
|------|------|------------------|
| Development | é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ | ãƒ­ãƒ¼ã‚«ãƒ« |
| Staging | æ¤œè¨¼ | `develop` ãƒ–ãƒ©ãƒ³ãƒ push |
| Production | æœ¬ç•ª | `main` ãƒ–ãƒ©ãƒ³ãƒ æ‰‹å‹• |

### 7.2 ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. ãƒ“ãƒ«ãƒ‰
npm run build

# 3. SAM ãƒ“ãƒ«ãƒ‰
sam build --template infrastructure/template.yaml

# 4. ãƒ‡ãƒ—ãƒ­ã‚¤
sam deploy --guided  # åˆå›
sam deploy           # 2å›ç›®ä»¥é™
```

### 7.3 CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```yaml
# .github/workflows/ci.yml
- Lint (ESLint)
- Type Check (tsc)
- Unit Tests (Jest)
- Security Scan (npm audit)

# .github/workflows/deploy-staging.yml
- develop ãƒ–ãƒ©ãƒ³ãƒã¸ã® push ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

# .github/workflows/deploy-production.yml
- main ãƒ–ãƒ©ãƒ³ãƒã¸ã® push + æ‰‹å‹•æ‰¿èªã§ãƒ‡ãƒ—ãƒ­ã‚¤
```

---

## 8. é‹ç”¨

### 8.1 ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ

| ã‚¢ãƒ©ãƒ¼ãƒˆ | æ¡ä»¶ | é€šçŸ¥å…ˆ |
|----------|------|--------|
| Lambda Error Rate | > 1% | Slack/Email |
| API Latency | > 5s (P95) | Slack/Email |
| DynamoDB Throttle | > 0 | Slack/Email |
| Dead Letter Queue | > 0 messages | Slack/Email |

### 8.2 ãƒ­ã‚°

```typescript
// æ§‹é€ åŒ–ãƒ­ã‚°å½¢å¼
{
  "timestamp": "2025-12-05T10:30:00Z",
  "level": "INFO",
  "service": "lark-message-hub",
  "function": "InboundHandler",
  "requestId": "abc-123",
  "message": "Message processed",
  "metadata": {
    "channel": "line",
    "customerId": "cust-456",
    "threadId": "thread-789"
  }
}
```

### 8.3 éšœå®³å¯¾å¿œ

1. **CloudWatch Alarms** ã§ã‚¢ãƒ©ãƒ¼ãƒˆæ¤œçŸ¥
2. **X-Ray** ã§ãƒˆãƒ¬ãƒ¼ã‚¹ç¢ºèª
3. **CloudWatch Logs** ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ç¢ºèª
4. å¿…è¦ã«å¿œã˜ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

## 9. ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----------|------|------------|
| Phase 1 (MVP) | Infrastructure + LINE/Webchat + Larké€šçŸ¥ | âœ… å®Œäº† |
| Phase 2 | SMS/WhatsApp/Email + å®šå‹æ–‡ + ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… å®Œäº† |
| Phase 3 | Facebook/Instagram + é«˜åº¦ãªé€šçŸ¥ãƒ«ãƒ¼ãƒ« | âœ… å®Œäº† |
| Phase 4 | LinkedIn + AIçµ±åˆ + åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | âœ… å®Œäº† |
| NFR | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ + ç›£è¦– + ä¿¡é ¼æ€§ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | âœ… å®Œäº† |

---

## 10. ä»˜éŒ²

### 10.1 ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| Inbound | é¡§å®¢ã‹ã‚‰ä¼æ¥­ã¸ã®å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| Outbound | ä¼æ¥­ã‹ã‚‰é¡§å®¢ã¸ã®é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| Thread | ä¸€é€£ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¾ã¨ã¾ã‚Šï¼ˆä¼šè©±ï¼‰ |
| Interactive Card | Lark ã®ãƒœã‚¿ãƒ³ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ |
| Webhook | HTTPã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã‚ˆã‚‹ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ |

### 10.2 å‚è€ƒãƒªãƒ³ã‚¯

- [Lark Open Platform](https://open.larksuite.com/)
- [Twilio Conversations](https://www.twilio.com/docs/conversations)
- [Meta Graph API](https://developers.facebook.com/docs/graph-api/)
- [LinkedIn Marketing API](https://learn.microsoft.com/en-us/linkedin/marketing/)
- [AWS SAM](https://docs.aws.amazon.com/serverless-application-model/)

---

## 11. æ‰¿èª

| å½¹å‰² | åå‰ | æ—¥ä»˜ | ç½²å |
|------|------|------|------|
| ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ | | | |
| ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰ | | | |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | | | |

---

*æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ Miyabi Framework ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*

ğŸŒ¸ Generated with [Claude Code](https://claude.com/claude-code)
